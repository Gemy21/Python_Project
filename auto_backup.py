"""
Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ

Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙŠÙ…ÙƒÙ† Ø¬Ø¯ÙˆÙ„ØªÙ‡ Ù„Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ ÙŠÙˆÙ… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:
- Windows Task Scheduler (Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙÙŠ ÙˆÙŠÙ†Ø¯ÙˆØ²)
- cron (ÙÙŠ Ù„ÙŠÙ†ÙƒØ³/Ù…Ø§Ùƒ)

Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
1. Ø§ÙØªØ­ "Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ù‡Ø§Ù…" ÙÙŠ ÙˆÙŠÙ†Ø¯ÙˆØ²
2. Ø£Ù†Ø´Ø¦ Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
3. Ø§Ø¶Ø¨Ø·Ù‡Ø§ Ù„Ù„ØªØ´ØºÙŠÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ (Ù…Ø«Ù„Ø§Ù‹ 11:00 Ù…Ø³Ø§Ø¡Ù‹)
4. Ø§Ø¬Ø¹Ù„Ù‡Ø§ ØªØ´ØºÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª: python auto_backup.py
"""

import sys
import os
from datetime import datetime
from data_sync import DataSync

def main():
    """ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ"""
    
    print("=" * 60)
    print("Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ")
    print(f"Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("=" * 60)
    
    try:
        # Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        sync = DataSync()
        
        # ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        print("\nðŸ“¤ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØµØ¯ÙŠØ±...")
        filepath = sync.create_daily_backup()
        
        # Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…)
        print("\nðŸ—‘ Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©...")
        sync.cleanup_old_backups(keep_days=30)
        
        print("\n" + "=" * 60)
        print("âœ“ Ø§ÙƒØªÙ…Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¨Ù†Ø¬Ø§Ø­!")
        print(f"âœ“ Ø§Ù„Ù…Ù„Ù: {os.path.basename(filepath)}")
        print(f"âœ“ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„: {filepath}")
        print("=" * 60)
        
        # ÙƒØªØ§Ø¨Ø© Ø³Ø¬Ù„ ÙÙŠ Ù…Ù„Ù log
        log_file = "backup_log.txt"
        with open(log_file, 'a', encoding='utf-8') as f:
            f.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - Ù†Ø¬Ø­ - {filepath}\n")
        
        return 0  # Ù†Ø¬Ø­
        
    except Exception as e:
        print("\n" + "=" * 60)
        print("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ!")
        print(f"âŒ Ø§Ù„Ø®Ø·Ø£: {str(e)}")
        print("=" * 60)
        
        # ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ù log
        log_file = "backup_log.txt"
        with open(log_file, 'a', encoding='utf-8') as f:
            f.write(f"{datetime.now().strftime('%Y-%m-%d %H:%M:%S')} - ÙØ´Ù„ - {str(e)}\n")
        
        return 1  # ÙØ´Ù„

if __name__ == "__main__":
    exit_code = main()
    
    # Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø£Ù† ØªØ¨Ù‚Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…ÙØªÙˆØ­Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    if len(sys.argv) > 1 and sys.argv[1] == '--wait':
        input("\nØ§Ø¶ØºØ· Enter Ù„Ù„Ø®Ø±ÙˆØ¬...")
    
    sys.exit(exit_code)
