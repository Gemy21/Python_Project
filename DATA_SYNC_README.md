# نظام مزامنة البيانات

## نظرة عامة
نظام مزامنة البيانات يتيح لك نقل البيانات بين نسختين من البرنامج على جهازين مختلفين، والاحتفاظ بنسخ احتياطية يومية من جميع بياناتك.

## المميزات
- ✅ تصدير جميع البيانات إلى ملف JSON واحد
- ✅ استيراد البيانات من ملف احتياطي
- ✅ دعم ثلاث طرق للدمج (تحديث، استبدال، تخطي)
- ✅ إنشاء نسخ احتياطية يومية تلقائية
- ✅ عرض وإدارة النسخ الاحتياطية
- ✅ حذف النسخ القديمة تلقائياً

## كيفية الاستخدام

### 1. تصدير البيانات (على الجهاز الأول)

#### من خلال الواجهة الرسومية:
1. افتح البرنامج
2. اضغط على زر "مزامنة البيانات" في الشاشة الرئيسية
3. اضغط على "تصدير البيانات الآن"
4. سيتم إنشاء ملف في مجلد `data_exports`

#### من خلال سطر الأوامر:
```python
from data_sync import DataSync

sync = DataSync()
filepath = sync.create_daily_backup()
print(f"تم التصدير إلى: {filepath}")
```

### 2. نقل الملف إلى الجهاز الثاني
- انسخ الملف من مجلد `data_exports` على الجهاز الأول
- انقله إلى مجلد `data_exports` على الجهاز الثاني
- يمكنك استخدام USB، البريد الإلكتروني، أو أي وسيلة نقل ملفات

### 3. استيراد البيانات (على الجهاز الثاني)

#### من خلال الواجهة الرسومية:
1. افتح البرنامج على الجهاز الثاني
2. اضغط على زر "مزامنة البيانات"
3. اختر طريقة الدمج المناسبة:
   - **تحديث**: يحدث السجلات الموجودة ويضيف الجديدة (مُوصى به)
   - **استبدال**: يحذف البيانات القديمة ويستبدلها بالجديدة (خطر!)
   - **تخطي**: يضيف السجلات الجديدة فقط ويتخطى الموجودة
4. اضغط على "استيراد من ملف"
5. اختر ملف النسخة الاحتياطية
6. أكد عملية الاستيراد

#### من خلال سطر الأوامر:
```python
from data_sync import DataSync

sync = DataSync()
stats = sync.import_data('data_exports/backup_2025-12-02.json', merge_mode='update')
print(f"تم استيراد {stats['rows_inserted']} سجل")
```

## طرق الدمج

### 1. تحديث (update) - الأكثر أماناً ✅
- يحدث السجلات الموجودة بنفس الـ ID
- يضيف السجلات الجديدة
- **مُوصى به** للمزامنة اليومية

### 2. استبدال (replace) - خطر ⚠️
- يحذف جميع السجلات القديمة
- يستبدلها بالبيانات الجديدة
- استخدمه فقط إذا كنت متأكداً

### 3. تخطي (skip)
- يضيف السجلات الجديدة فقط
- يتخطى السجلات الموجودة بنفس الـ ID
- مفيد لدمج بيانات من مصادر مختلفة

## الجداول المُصدَّرة
يتم تصدير البيانات من الجداول التالية:
- ✅ `sellers_accounts` - حسابات البائعين
- ✅ `seller_transactions` - معاملات البائعين
- ✅ `clients_accounts` - حسابات العملاء
- ✅ `inventory_items` - العدة
- ✅ `meals` - الوجبات والأصناف
- ✅ `agriculture_transfers` - ترحيل الزراعة
- ✅ `expenses` - المنصرفات
- ✅ `client_invoices` - فواتير العملاء

## إدارة النسخ الاحتياطية

### عرض النسخ المتاحة
```python
from data_sync import DataSync

sync = DataSync()
backups = sync.list_backups()
```

### حذف النسخ القديمة
```python
from data_sync import DataSync

sync = DataSync()
sync.cleanup_old_backups(keep_days=30)  # الاحتفاظ بآخر 30 يوم فقط
```

## الاستخدام اليومي المُوصى به

### على الجهاز الرئيسي (كل يوم):
1. في نهاية اليوم، اضغط على "مزامنة البيانات"
2. اضغط على "تصدير البيانات الآن"
3. انسخ الملف المُنشأ إلى USB أو أرسله بالبريد

### على الجهاز الثانوي (كل يوم):
1. افتح البرنامج
2. اضغط على "مزامنة البيانات"
3. اختر "تحديث (إضافة وتحديث)"
4. اضغط على "استيراد من ملف"
5. اختر ملف اليوم

## الأمان والنسخ الاحتياطي

### نصائح مهمة:
- ⚠️ **دائماً** احتفظ بنسخة احتياطية قبل الاستيراد
- ✅ استخدم طريقة "تحديث" للمزامنة اليومية
- ✅ احتفظ بالنسخ الاحتياطية لمدة 30 يوم على الأقل
- ✅ اختبر عملية الاستيراد على قاعدة بيانات تجريبية أولاً

### استعادة من نسخة احتياطية:
إذا حدث خطأ، يمكنك استعادة البيانات:
1. احذف ملف `company_accounts.db`
2. استورد من آخر نسخة احتياطية صحيحة
3. استخدم طريقة "استبدال"

## استكشاف الأخطاء

### الملف غير موجود
- تأكد من وجود مجلد `data_exports`
- تأكد من نسخ الملف بشكل صحيح

### خطأ في الاستيراد
- تحقق من أن الملف بصيغة JSON صحيحة
- تأكد من أن الملف تم تصديره من نفس إصدار البرنامج

### بيانات مكررة
- استخدم طريقة "تحديث" بدلاً من "تخطي"
- أو احذف السجلات المكررة يدوياً

## مثال عملي كامل

```python
# على الجهاز الأول - تصدير
from data_sync import DataSync

sync = DataSync()
filepath = sync.create_daily_backup()
print(f"✓ تم التصدير: {filepath}")

# نقل الملف إلى الجهاز الثاني...

# على الجهاز الثاني - استيراد
sync2 = DataSync()
stats = sync2.import_data(filepath, merge_mode='update')
print(f"✓ تم استيراد {stats['rows_inserted']} سجل جديد")
print(f"✓ تم تحديث {stats['rows_updated']} سجل موجود")
```

## الدعم
إذا واجهت أي مشاكل، تحقق من:
1. سجلات الأخطاء في Console
2. صلاحيات الملفات والمجلدات
3. مساحة القرص المتاحة
4. إصدار Python (يجب أن يكون 3.7 أو أحدث)

---

**ملاحظة**: هذا النظام مصمم للاستخدام المحلي. لا تشارك ملفات النسخ الاحتياطية مع أطراف غير موثوقة لأنها تحتوي على جميع بياناتك الحساسة.
